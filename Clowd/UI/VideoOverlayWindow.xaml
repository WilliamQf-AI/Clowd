<Window
    x:Class="Clowd.UI.VideoOverlayWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Clowd.UI.Controls"
    xmlns:conv="clr-namespace:Clowd.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Clowd.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Clowd Capture"
    Width="1"
    Height="1"
    AllowsTransparency="True"
    DataContext="{Binding RelativeSource={RelativeSource Self}}"
    Icon="/Images/default.ico"
    Left="0"
    ResizeMode="NoResize"
    ShowInTaskbar="False"
    SnapsToDevicePixels="True"
    Top="0"
    Topmost="True"
    WindowStyle="None"
    mc:Ignorable="d">
    <Window.Background>
        <SolidColorBrush Opacity="0.00" Color="#FFFFFF" />
    </Window.Background>
    <Window.Resources>
        <conv:BoolToVisibilityConverter2 x:Key="Bool2Vis" />
        <conv:BoolToInverseVisibilityConverter x:Key="Bool2InverseVis" />
        <conv:OnOffBrushConverter x:Key="OnOffBrush" />
        <Style x:Key="AudioLevelProgressBarStyle" TargetType="ProgressBar">
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="Height" Value="2" />
            <Setter Property="Margin" Value="0,5" />
            <Setter Property="LayoutTransform">
                <Setter.Value>
                    <RotateTransform Angle="-90" />
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid Name="TemplateRoot" SnapsToDevicePixels="True">
                            <Rectangle
                                Name="PART_Track"
                                Fill="White"
                                Opacity="0.6" />
                            <Rectangle
                                Name="PART_Indicator"
                                HorizontalAlignment="Left"
                                Fill="{StaticResource AccentColorBrush}" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Canvas
            Name="dynamicCanvas"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">

            <controls:SelectionBorderControl
                Canvas.Left="{Binding CroppingRectangleWpf.Left}"
                Canvas.Top="{Binding CroppingRectangleWpf.Top}"
                Width="{Binding CroppingRectangleWpf.Width}"
                Height="{Binding CroppingRectangleWpf.Height}"
                BorderBrush="Red"
                IsEnabled="False"
                SelectionRectangle="{Binding CroppingRectangleWpf}" />

            <StackPanel
                Name="toolActionBarStackPanel"
                Background="#373737"
                Orientation="Horizontal">

                <controls:CaptureToolButton
                    x:Name="recordingLabelButton"
                    IconPath="{StaticResource IconClowd}"
                    IsEnabled="False"
                    Text="CLOWD" />

                <Rectangle
                    MinWidth="3"
                    MinHeight="3"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Fill="#373737" />

                <controls:CaptureToolButton
                    Background="#373737"
                    Click="buttonStart_Click"
                    IconPath="{StaticResource IconPlay}"
                    Text="Start"
                    Visibility="{Binding IsStarted, Converter={StaticResource Bool2InverseVis}}" />

                <controls:CaptureToolButton
                    Background="#373737"
                    Click="buttonStop_Click"
                    IconPath="{StaticResource IconPlay}"
                    IsEnabled="{Binding IsRecording}"
                    Text="Finish"
                    Visibility="{Binding IsStarted, Converter={StaticResource Bool2Vis}}" />

                <Button
                    Background="#373737"
                    Click="toggleMicrophone_Click"
                    IsEnabled="{Binding IsAudioSupported}"
                    Style="{StaticResource CaptureToolButtonStyle}"
                    ToolTip="Capture microphone Audio&#x0a;Must be using an encoder preset that supports audio&#x0a;Must have a microphone selected in settings"
                    ToolTipService.ShowOnDisabled="True">
                    <Grid>
                        <ProgressBar
                            x:Name="levelMic"
                            Style="{StaticResource AudioLevelProgressBarStyle}"
                            Visibility="{Binding IsMicrophoneEnabled, Converter={StaticResource Bool2Vis}}" />
                        <StackPanel Margin="5" Orientation="Vertical">
                            <Viewbox
                                Width="26"
                                Height="26"
                                Visibility="{Binding IsMicrophoneEnabled, Converter={StaticResource Bool2InverseVis}}">
                                <Path
                                    Width="172"
                                    Height="172"
                                    Data="M86,21.5c-11.87517,0 -21.5,9.62483 -21.5,21.5v43c0,11.87517 9.62483,21.5 21.5,21.5c11.87517,0 21.5,-9.62483 21.5,-21.5v-43c0,-11.87517 -9.62483,-21.5 -21.5,-21.5zM43.62988,86c-4.343,0 -7.841,3.86082 -7.13867,8.14649c3.50433,21.50444 20.70584,38.35789 42.34212,41.46028v14.89323c0,3.956 3.21067,7.16667 7.16667,7.16667c3.956,0 7.16667,-3.21067 7.16667,-7.16667v-14.90723c5.18974,-0.7623 10.14102,-2.28168 14.69726,-4.49316l-11.09993,-11.09993c-3.4185,1.08217 -6.98716,1.83366 -10.764,1.83366c-17.70883,0 -32.4201,-12.8458 -35.31543,-29.73047c-0.59483,-3.49016 -3.50036,-6.10286 -7.04069,-6.10286zM124.80078,110.46744c-1.83376,0 -3.66597,0.69853 -5.06706,2.09961c-2.80217,2.795 -2.80217,7.33195 0,10.13412l10.13412,10.13411l-10.13412,10.13412c-2.80217,2.795 -2.80217,7.33194 0,10.13411c2.795,2.80217 7.33195,2.80217 10.13412,0l10.13411,-10.13411l10.13412,10.13411c2.795,2.80217 7.33194,2.80217 10.13411,0c2.795,-2.80217 2.795,-7.33911 0,-10.13411l-10.13411,-10.13412l10.13411,-10.13411c2.80217,-2.795 2.80217,-7.33195 0,-10.13412c-2.80217,-2.795 -7.33911,-2.795 -10.13411,0l-10.13412,10.13412l-10.13411,-10.13412c-1.3975,-1.40108 -3.23329,-2.09961 -5.06706,-2.09961z"
                                    Fill="White"
                                    Opacity="0.6" />
                            </Viewbox>
                            <Viewbox
                                Width="26"
                                Height="26"
                                Margin="0,1,0,-1"
                                Visibility="{Binding IsMicrophoneEnabled, Converter={StaticResource Bool2Vis}}">
                                <Path
                                    Width="172"
                                    Height="172"
                                    Data="M86,14.33333c-11.87517,0 -21.5,9.62483 -21.5,21.5v43c0,11.87517 9.62483,21.5 21.5,21.5c11.87517,0 21.5,-9.62483 21.5,-21.5v-43c0,-11.87517 -9.62483,-21.5 -21.5,-21.5zM43.62988,78.83333c-4.343,0 -7.841,3.85365 -7.13867,8.14649c3.5108,21.49797 20.70692,38.35796 42.34212,41.46028v14.89323c0,3.956 3.21067,7.16667 7.16667,7.16667c3.956,0 7.16667,-3.21067 7.16667,-7.16667v-14.89323c21.63521,-3.10233 38.83133,-19.96231 42.34212,-41.46028c0.70233,-4.29283 -2.79567,-8.14649 -7.13867,-8.14649c-3.54033,0 -6.45985,2.60553 -7.05469,6.10286c-2.9025,16.87751 -17.60659,29.73047 -35.31543,29.73047c-17.70883,0 -32.41293,-12.85297 -35.31543,-29.73047c-0.59483,-3.49733 -3.50719,-6.10286 -7.05469,-6.10286z"
                                    Fill="White" />
                            </Viewbox>
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="DemiBold"
                                    Foreground="White">
                                    MIC
                                </TextBlock>
                                <Border
                                    Width="10"
                                    Height="10"
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Background="{Binding IsMicrophoneEnabled, Converter={StaticResource OnOffBrush}}"
                                    CornerRadius="5" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Button>
                <Button
                    Background="#373737"
                    Click="toggleSpeaker_Click"
                    IsEnabled="{Binding IsAudioSupported}"
                    Style="{StaticResource CaptureToolButtonStyle}"
                    ToolTip="Capture system audio&#x0a;Must be using an encoder preset that supports audio&#x0a;Must have 'DirectShow Add-ons' installed (check settings)"
                    ToolTipService.ShowOnDisabled="True">
                    <Grid>
                        <ProgressBar
                            x:Name="levelSpeaker"
                            Style="{StaticResource AudioLevelProgressBarStyle}"
                            Visibility="{Binding IsLoopbackEnabled, Converter={StaticResource Bool2Vis}}" />
                        <StackPanel Margin="5" Orientation="Vertical">
                            <Viewbox
                                Width="26"
                                Height="26"
                                Visibility="{Binding IsLoopbackEnabled, Converter={StaticResource Bool2InverseVis}}">
                                <Path
                                    Width="172"
                                    Height="172"
                                    Data="M80.94694,28.58268c-1.23267,0 -2.48852,0.46606 -3.51334,1.48372l-34.4336,34.43359h-14.33333c-7.91917,0 -14.33333,6.41417 -14.33333,14.33333v14.33333c0,7.91917 6.41417,14.33333 14.33333,14.33333h14.33333l34.4336,34.4336c1.02483,1.02483 2.28068,1.48372 3.51334,1.48372c2.58,0 5.05306,-2.00073 5.05306,-5.02507v-104.78451c0,-3.02433 -2.47306,-5.02507 -5.05306,-5.02507zM107.43001,57.26335c-2.91628,0.00077 -5.54133,1.76842 -6.6387,4.47035c-1.09737,2.70194 -0.44824,5.79937 1.64164,7.83336l16.43294,16.43294l-16.43294,16.43294c-1.87223,1.79752 -2.62641,4.46675 -1.97168,6.97825c0.65472,2.5115 2.61605,4.47282 5.12755,5.12755c2.5115,0.65472 5.18073,-0.09946 6.97825,-1.97168l16.43294,-16.43294l16.43294,16.43294c1.79752,1.87223 4.46675,2.62641 6.97825,1.97168c2.5115,-0.65472 4.47282,-2.61605 5.12755,-5.12755c0.65472,-2.5115 -0.09946,-5.18073 -1.97168,-6.97825l-16.43294,-16.43294l16.43294,-16.43294c2.11962,-2.06035 2.75694,-5.21064 1.60486,-7.93287c-1.15207,-2.72224 -3.85719,-4.45797 -6.81189,-4.37084c-1.86189,0.05548 -3.62905,0.83363 -4.92708,2.1696l-16.43294,16.43295l-16.43294,-16.43295c-1.34928,-1.38699 -3.20203,-2.16948 -5.13705,-2.1696z"
                                    Fill="White"
                                    Opacity="0.6" />
                            </Viewbox>
                            <Viewbox
                                Width="26"
                                Height="26"
                                Visibility="{Binding IsLoopbackEnabled, Converter={StaticResource Bool2Vis}}">
                                <Path
                                    Width="172"
                                    Height="172"
                                    Data="M80.94694,28.66667c-1.23267,0 -2.48852,0.45206 -3.51334,1.46973l-34.4336,34.44759h-14.33333c-7.91917,0 -14.33333,6.41417 -14.33333,14.33333v14.33333c0,7.91917 6.41417,14.33333 14.33333,14.33333h14.33333l34.4336,34.43359c1.02483,1.02483 2.28068,1.46973 3.51334,1.46973c2.58,0 5.05306,-2.00073 5.05306,-5.02507v-104.7705c0,-3.02433 -2.47306,-5.02507 -5.05306,-5.02507zM150.5,35.83333c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM129,50.16667c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM107.5,64.5c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM129,78.83333c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM150.5,78.83333c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM107.5,93.16667c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM129,107.5c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667zM150.5,121.83333c-3.95804,0 -7.16667,3.20863 -7.16667,7.16667c0,3.95804 3.20863,7.16667 7.16667,7.16667c3.95804,0 7.16667,-3.20863 7.16667,-7.16667c0,-3.95804 -3.20863,-7.16667 -7.16667,-7.16667z"
                                    Fill="White" />
                            </Viewbox>
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="DemiBold"
                                    Foreground="White">
                                    SPK
                                </TextBlock>
                                <Border
                                    Width="10"
                                    Height="10"
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Background="{Binding IsLoopbackEnabled, Converter={StaticResource OnOffBrush}}"
                                    CornerRadius="5" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Button>

                <controls:CaptureToolButton
                    Background="#373737"
                    Click="settings_Click"
                    IconPath="{StaticResource IconSettings}"
                    IsEnabled="{Binding IsNotStarted}"
                    Text="TUNE"
                    Visibility="{Binding IsNotStarted, Converter={StaticResource Bool2Vis}}" />

                <controls:CaptureToolButton
                    Background="#373737"
                    Click="draw_Click"
                    IconPath="{StaticResource IconDrawing}"
                    IsEnabled="{Binding IsStarted}"
                    Text="DRAW"
                    Visibility="{Binding IsStarted, Converter={StaticResource Bool2Vis}}" />

                <controls:CaptureToolButton
                    Background="#373737"
                    Click="buttonCancel_Click"
                    IconPath="{StaticResource IconClose}"
                    Text="CANCEL" />

            </StackPanel>
            <Grid
                Canvas.Left="{Binding CroppingRectangleWpf.Left}"
                Canvas.Top="{Binding CroppingRectangleWpf.Top}"
                Width="{Binding CroppingRectangleWpf.Width}"
                Height="{Binding CroppingRectangleWpf.Height}">
                <controls:OutlinedTextBlock
                    x:Name="labelCountdown"
                    MinWidth="20"
                    MinHeight="20"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Fill="Red"
                    FontSize="40"
                    Opacity="1"
                    Stroke="White"
                    StrokeThickness="4"
                    Text="Press Start" />
            </Grid>
        </Canvas>
    </Grid>
</Window>
